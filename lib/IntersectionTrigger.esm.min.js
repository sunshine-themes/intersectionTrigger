/*
* IntersectionTrigger v1.0.0
* https://sunshine-themes.com/intersectionTrigger
*
* @license Copyright 2022, Sunshine. All rights reserved.
* Subject to the terms at https://sunshine-themes.com/intersectionTrigger/standard-licensew.
* @author: Sherif magdy, sherifmagdy@sunshine-themes.com
*/
                  
var T={defaults:{once:!1,onEnter:null,onLeave:null,onEnterBack:null,onLeaveBack:null},enter:"0% 100%",leave:"100% 0%",axis:"y",name:"",root:null,onScroll:null},L={hasEntered:!1,hasEnteredBack:!1,hasLeft:!0,hasLeftBack:!0,hasFirstEntered:!1,onScroll:null};var b=class{constructor(t){return this._it=t,this.setHelpers(),this}setHelpers(){this.is={function:t=>typeof t=="function",string:t=>typeof t=="string",boolean:t=>typeof t=="boolean",object:t=>t&&typeof t=="object"&&!(t instanceof Array),inObject:(t,e)=>this.is.object(t)&&e in t,percent:t=>t&&t.includes("%"),pixel:t=>t&&t.includes("px"),array:t=>t instanceof Array,element:t=>t instanceof HTMLElement||t instanceof Element,rootViewport:t=>!t,doc:t=>t&&t.nodeType===9,scrollable:(t,e=null)=>e?e==="y"?t.scrollHeight>t.clientHeight:t.scrollWidth>t.clientWidth:t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth,virtical:()=>this._it.axis==="y",horizontal:()=>this._it.axis==="x"},this.getBoundsProp=(t,e)=>t&&t.getBoundingClientRect()[e],this.getRoot=()=>this._it._root?this._it._root:window,this.getScrollValue=(t,e)=>e==="y"?t.scrollHeight:t.scrollWidth,this.dirProps=()=>this.is.virtical()?{ref:"top",length:"height",refOpposite:"bottom",innerLength:innerHeight}:{ref:"left",length:"width",refOpposite:"right",innerLength:innerWidth},this.roundFloat=(t,e)=>{this.is.string(t)&&(t=parseFloat(t));let s=Math.pow(10,e||0);return Math.round(t*s)/s},this.getParents=t=>{let e=[];for(t=t.parentNode;t&&t!==document&&t!==document.documentElement;t=t.parentNode)e.push(t);return e},this.mergeOptions=(t,e)=>{let s=t,i=e;return Object.entries(s).forEach(([r,o])=>{this.is.object(o)?this.mergeOptions(o,i[r]=i[r]||{}):r in i||(i[r]=o)}),i},this.throwError=t=>{throw new Error(t)},this.boundsMinusScrollbar=t=>{let e=t.getBoundingClientRect(),{top:s,bottom:i,right:r,left:o,height:n,width:a,x:g,y:u}=e;return{top:s,left:o,height:n,width:a,x:g,y:u,right:r-(r-o-t.clientWidth),bottom:i-(i-s-t.clientHeight)}}}},B=b;var m=class{constructor(t){return this._it=t,this._helpers=this._it._helpers,this.setUtils(),this}setUtils(){this.setRootMargin=()=>{let t=this._helpers.getScrollValue(this._helpers.is.rootViewport(this._it._root)?document.body:this._it._root,this._helpers.is.virtical()?"x":"y");return this._helpers.is.virtical()?`${this._it._positions.rootEndPosition.strValue} ${t}px ${this._it._positions.rootStartPosition.strValue} ${t}px`:`${t}px ${this._it._positions.rootStartPosition.strValue} ${t}px ${this._it._positions.rootEndPosition.strValue}`},this.setThreshold=()=>{let t=[0,this._it._triggerParams.enter,this._it._triggerParams.leave,this._helpers.roundFloat(1-this._it._triggerParams.leave,2),1];return this._it.triggers.forEach(e=>{let{enter:s,leave:i}=this.getTriggerData(e);t.push(s,i,this._helpers.roundFloat(1-i,2))}),[...new Set(t)]},this.parseQuery=(t,e="trigger")=>{let s=e==="trigger",i=s?[]:{};if(!s)return i=this._helpers.is.string(t)?document.querySelector(t):this._helpers.is.element(t)?t:this._helpers.throwError("root parameter must be a valid selector or an element"),i;switch(!0){case this._helpers.is.string(t):i=[...document.querySelectorAll(t)];break;case this._helpers.is.array(t):i=t;break;case this._helpers.is.element(t):i=[t];break;default:this._helpers.throwError("trigger parameter must be a valid selector, an element or array of elements");break}return i},this.validatePosition=(t,e)=>(this._helpers.is.function(e)&&(e=e(this)),this._helpers.is.string(e)||this._helpers.throwError(`${t} parameter must be a string.`),e),this.setPositionData=(t,e=!0,s=!0)=>{t=this.validatePosition(s?"enter":"leave",t);let i=t.trim(),r=this._helpers.is.percent(i),o=this._helpers.is.pixel(i),n={};if(i=r?i.replace("%",""):o?i.replace("px",""):i,i=this._helpers.roundFloat(i),n.type=r?"percent":"pixel",r&&e)return n.value=i/100,n.strValue=`${i}%`,n;let{length:a,innerLength:g}=this._helpers.dirProps(),u=this._it._root?this._helpers.getBoundsProp(this._it._root,a):g;switch(!0){case(r&&s):n.value=this._helpers.roundFloat(i/100-1,2),n.strValue=`${n.value*100}%`;break;case(r&&!s):n.value=-i/100,n.strValue=`${n.value*100}%`;break;case(o&&s):n.value=this._helpers.roundFloat(i-u,2),n.strValue=`${n.value}px`;break;case(o&&!s):n.value=-i,n.strValue=`${-i}px`;break}return n.guide=t,n},this.parsePositions=(t="",e="")=>{t=this.validatePosition("enter",t),e=this.validatePosition("leave",e);let s={},i={},r={},o={},n=t.trim().split(/\s+/g,2),a=e.trim().split(/\s+/g,2);return[...n,...a].forEach((h,p)=>{switch(p){case 0:s=this.setPositionData(h);break;case 1:r=this.setPositionData(h,!1);break;case 2:i=this.setPositionData(h);break;case 3:o=this.setPositionData(h,!1,!1);break}}),{triggerLeavePosition:i,triggerEnterPosition:s,rootEndPosition:o,rootStartPosition:r}},this.deleteTriggerData=t=>{this._it._triggersData.delete(t)},this.hasTriggerData=(t,e=null)=>{let s=this._it._triggersData.has(t);return e?s&&e in this.getTriggerData(t):s},this.getTriggerData=(t,e=null)=>e?this.hasTriggerData(t,e)?this._it._triggersData.get(t)[e]:{}:this.hasTriggerData(t)&&this._it._triggersData.get(t)||{},this.setTriggerData=(t,e,s=null)=>{if(s){let i=this.getTriggerData(t);this._helpers.is.object(i)&&this._it._triggersData.set(t,{...i,...s});return}this._it._triggersData.set(t,e)},this.getTriggerStates=t=>{let e=this.getTriggerData(t,"states"),s=e.hasEntered||e.hasEnteredBack;return{...e,hasEnteredFromOneSide:s}},this.setTriggerStates=(t,e={})=>{let s=this.getTriggerData(t),i=s&&{...s.states,...e};this.setTriggerData(t,null,{states:i})},this.onTriggerEnter=(t,e)=>{let{hasFirstEntered:s}=this.getTriggerStates(t);this._helpers.is.function(e.enterFun)&&e.enterFun(t,this);let i=s?{[e.enterProp]:!0,[e.leaveProp]:!1}:{[e.enterProp]:!0,hasLeft:!1,hasLeftBack:!1};this.setTriggerStates(t,i),s||this.setTriggerStates(t,{hasFirstEntered:!0})},this.onTriggerLeave=(t,e)=>{let{once:s}=this.getTriggerData(t),{hasFirstEntered:i}=this.getTriggerStates(t);this._helpers.is.function(e.leaveFun)&&e.leaveFun(t,this),this.setTriggerStates(t,{[e.leaveProp]:!0,hasEntered:!1,hasEnteredBack:!1}),s&&i&&this._it.remove(t)},this.toggleActions=t=>{let e=t.getBoundingClientRect();this._it.rootBounds=this.getRootRect(this._it.observer.rootMargin);let s=this._it.rootBounds,{enter:i,leave:r,onEnter:o,onEnterBack:n,onLeave:a,onLeaveBack:g}=this.getTriggerData(t),{hasEnteredFromOneSide:u,hasLeft:h,hasLeftBack:p}=this.getTriggerStates(t),{ref:c,refOpposite:_,length:l}=this._helpers.dirProps(),d=!0;switch(!0){case(p&&e[c]+i*e[l]<=s[_]&&e[c]+i*e[l]>s[c]):this.onTriggerEnter(t,{enterFun:o,enterProp:"hasEntered",leaveProp:"hasLeftBack"});break;case(u&&e[c]+r*e[l]<=s[c]):this.onTriggerLeave(t,{leaveFun:a,leaveProp:"hasLeft"});break;case(h&&e[c]+r*e[l]>=s[c]&&e[c]+r*e[l]<s[_]):this.onTriggerEnter(t,{enterFun:n,enterProp:"hasEnteredBack",leaveProp:"hasLeft"});break;case(u&&e[c]+i*e[l]>=s[_]):this.onTriggerLeave(t,{leaveFun:g,leaveProp:"hasLeftBack"});break;default:d=!1;break}return d},this.validateOptions=t=>{for(let e in t){let s=t[e],i=(r,o)=>{switch(r){case"once":!this._helpers.is.boolean(o)&&this._helpers.throwError("once parameter must be a boolean.");break;case"axis":case"name":!this._helpers.is.string(o)&&this._helpers.throwError("axis and name parameters must be strings.");break;case"guides":!this._helpers.is.boolean(o)&&!this._helpers.is.object(o)&&this._helpers.throwError("guides parameter must be a boolean or object.");break;case"onEnter":case"onEnterBack":case"onLeave":case"onLeaveBack":case"onScroll":!this._helpers.is.function(o)&&this._helpers.throwError("onEnter, onLeave, onEnterBack, onLeaveBack and onScroll parameters must be functions.");break}};if(!this._helpers.is.object(s)){i(e,s);continue}for(let r in s){let o=s[r];i(r,o)}}},this.parseString=t=>t.split(/\s+/).map(s=>{let i=/^(-?\d*\.?\d+)(px|%)$/.exec(s);return{value:parseFloat(i[1]),unit:i[2]}}),this.parseRootMargin=t=>{var e=t||"0px",s=this.parseString(e);return s[1]=s[1]||s[0],s[2]=s[2]||s[0],s[3]=s[3]||s[1],s},this.expandRectByRootMargin=(t,e)=>{let s=this.parseRootMargin(e).map((r,o)=>r.unit=="px"?r.value:r.value*(o%2?t.width:t.height)/100),i={top:t.top-s[0],right:t.right+s[1],bottom:t.bottom+s[2],left:t.left-s[3]};return i.width=i.right-i.left,i.height=i.bottom-i.top,i},this.getRootRect=t=>{let e;if(this._it._root&&!this._helpers.is.doc(this._it._root))return e=this._helpers.boundsMinusScrollbar(this._it._root),this.expandRectByRootMargin(e,t);let s=this._helpers.is.doc(this._it._root)?this._it._root:document,i=s.documentElement,r=s.body;return e={top:0,left:0,right:i.clientWidth||r.clientWidth,width:i.clientWidth||r.clientWidth,bottom:i.clientHeight||r.clientHeight,height:i.clientHeight||r.clientHeight},this.expandRectByRootMargin(e,t)}}},w=m;var f=[],x=0,D=class{constructor(t={}){this._userOptions=t,this.triggers=[],this._triggersData=new WeakMap,this._guidesInstance=null,this._helpers=new B(this),this._utils=new w(this),this.id=x,x++,f.push(this),this._setStates(),this._setInstance()}_setStates(){this._states={},this._states.hasInit=!1}_addScrollListener(){let t=this._helpers.getRoot();!!this._onScrollHandler&&t.removeEventListener("scroll",this._onScrollHandler,!1),this._onScrollHandler=e=>{this.triggers.forEach(s=>{let i=this._utils.getTriggerStates(s)?.onScroll;this._helpers.is.function(i)&&i(s)}),this._helpers.is.function(this.onScroll)&&this.onScroll(e,this)},t.addEventListener("scroll",this._onScrollHandler,!1)}_createInstance(){this._threshold=this._utils.setThreshold(),this._observerOptions={root:this._root,rootMargin:this._rootMargin,threshold:this._threshold},this.observer=new IntersectionObserver(this._observerCallback,this._observerOptions),this._root=this.observer.root,this.rootBounds=this._utils.getRootRect(this.observer.rootMargin),this._isRootViewport=this._helpers.is.rootViewport(this._root),this._addScrollListener()}_observerCallback=(t,e)=>{let{ref:s,refOpposite:i,length:r}=this._helpers.dirProps();for(let o of t){let n=o.target,a=o.boundingClientRect,g=o.isIntersecting,u=o.intersectionRatio;this.rootBounds=o.rootBounds||this._utils.getRootRect(e.rootMargin);let h=this.rootBounds,p=h[r],c=p/a[r],{enter:_,leave:l,onEnter:d,onLeave:v,onLeaveBack:R}=this._utils.getTriggerData(n),{hasEnteredFromOneSide:P,onScroll:I}=this._utils.getTriggerStates(n),O=a[r]>=p,F=_>c,y=1-l>c,S=O&&(F||y),k=!!I,H=a[s]+_*a[r]<h[i]&&a[s]+_*a[r]>h[s],M=a[s]+l*a[r]<h[i]&&a[s]+l*a[r]>h[s],$=a[s]+_*a[r]<h[s],V=a[s]+l*a[r]>h[i],C=a[s]+l*a[r]<h[s]&&u<1-l,W=a[s]<h[s],j=a[i]<h[s];switch(!0){case!this._states.hasInit:switch(!0){case(!g&&W&&j):this._utils.onTriggerEnter(n,{enterFun:d,enterProp:"hasEntered",leaveProp:"hasLeftBack"}),this._utils.onTriggerLeave(n,{leaveFun:v,leaveProp:"hasLeft"});break;case g:switch(!0){case(H||M||$&&V):this._utils.onTriggerEnter(n,{enterFun:d,enterProp:"hasEntered",leaveProp:"hasLeftBack"});break;case C:this._utils.onTriggerEnter(n,{enterFun:d,enterProp:"hasEntered",leaveProp:"hasLeftBack"}),this._utils.onTriggerLeave(n,{leaveFun:v,leaveProp:"hasLeft"});break}S&&this._utils.setTriggerStates(n,{onScroll:this._utils.toggleActions});break}break;case!g:switch(k&&this._utils.setTriggerStates(n,{onScroll:null}),!0){case(P&&a[i]<h[s]):this._utils.onTriggerLeave(n,{leaveFun:v,leaveProp:"hasLeft"});break;case(P&&a[s]>h[i]):this._utils.onTriggerLeave(n,{leaveFun:R,leaveProp:"hasLeftBack"});break}break;case(g&&!k):this._utils.toggleActions(n),S&&this._utils.setTriggerStates(n,{onScroll:this._utils.toggleActions});break}}this._states.hasInit=!0};_setInstance(){return this._defaultOptions=T,this._utils.validateOptions(this._userOptions),this._options=this._helpers.mergeOptions(this._defaultOptions,this._userOptions),this.axis=this._helpers.is.string(this._options.axis)?this._options.axis:this._helpers.throwError("axis parameter must be a string."),this.name=this._helpers.is.string(this._options.name)?this._options.name:this._helpers.throwError("name parameter must be a string."),this._root=!!this._options.root&&this._utils.parseQuery(this._options.root,"root")||null,this._positions=this._utils.parsePositions(this._options.enter,this._options.leave),this.onScroll=this._options.onScroll,this._triggerParams={once:this._options.defaults.once,enter:this._positions.triggerEnterPosition.value,leave:this._positions.triggerLeavePosition.value,onEnter:this._options.defaults.onEnter,onLeave:this._options.defaults.onLeave,onEnterBack:this._options.defaults.onEnterBack,onLeaveBack:this._options.defaults.onLeaveBack},this._rootMargin=this._utils.setRootMargin(),this._createInstance(),this}add(t={},e={}){let s=this._utils.parseQuery(t);this._utils.validateOptions(e),"enter"in e&&(e.enter=this._utils.setPositionData(e.enter).value),"leave"in e&&(e.leave=this._utils.setPositionData(e.leave).value);let i={...this._triggerParams,...e,states:{...L}};this.triggers=[...this.triggers,...s],this.triggers=[...new Set(this.triggers)];let r=!1;return[e.enter,e.leave].forEach(o=>!this._threshold.some(n=>o===n)&&(r=!0)),r?(this._disconnect(),s.forEach(o=>this._utils.setTriggerData(o,i)),this._createInstance(),this.triggers.forEach(o=>this.observer.observe(o))):s.forEach(o=>{this._utils.setTriggerData(o,i),this.observer.observe(o)}),this._guidesInstance&&this._guidesInstance.refresh(),this}remove(t={}){let e=this._utils.parseQuery(t);e.forEach(i=>{this._utils.deleteTriggerData(i),this.observer.unobserve(i)});let s=this.triggers.filter(i=>!e.some(o=>i===o));return this.triggers=s,this._guidesInstance&&this._guidesInstance.refresh(),this}_disconnect(){this.observer&&this.observer.disconnect(),this.observer=null}kill(){this._disconnect(),removeEventListener("scroll",this._onScrollHandler,!1),this.triggers=[],this.removeGuides();let t=f.indexOf(this);~t&&f.splice(t,1)}addGuides(t){return this._helpers.is.inObject(t,"_registerIntersectionTrigger")||this._helpers.throwError("Invalid Guides Instance."),t._registerIntersectionTrigger(this),t.refresh(),this._guidesInstance=t,this}removeGuides(){return this._guidesInstance&&this._guidesInstance.kill(),this._guidesInstance=null,this}};D.instances=f;export{D as default};
