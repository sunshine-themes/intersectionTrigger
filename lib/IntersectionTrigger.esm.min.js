/*
* IntersectionTrigger v1.0.0
* https://sunshine-themes.com/intersectionTrigger
*
* @license Copyright 2022, Sunshine. All rights reserved.
* Subject to the terms at https://sunshine-themes.com/intersectionTrigger/standard-licensew.
* @author: Sherif magdy, sherifmagdy@sunshine-themes.com
*/
                  
var b=()=>{},J=["add","remove","add","remove"],K=["play","finish","reverse","finish"],w={defaults:{once:!1,onEnter:b,onLeave:b,onEnterBack:b,onLeaveBack:b,toggleClass:null,animation:null},enter:"0% 100%",leave:"100% 0%",axis:"y",name:"",root:null,onScroll:b},B={hasEntered:!1,hasEnteredBack:!1,hasLeft:!0,hasLeftBack:!0,hasEnteredOnce:!1,onScroll:null};var S={targets:null,toggleActions:J,classNames:null},k={instance:null,toggleActions:K,control:!1};var h={function:r=>typeof r=="function",string:r=>typeof r=="string",boolean:r=>typeof r=="boolean",object:r=>r&&typeof r=="object"&&!(r instanceof Array),inObject:(r,t)=>h.object(r)&&t in r,percent:r=>r&&r.includes("%"),pixel:r=>r&&r.includes("px"),array:r=>r instanceof Array,element:r=>r instanceof HTMLElement||r instanceof Element,doc:r=>r&&r.nodeType===9,scrollable:(r,t=null)=>t?t==="y"?r.scrollHeight>r.clientHeight:r.scrollWidth>r.clientWidth:r.scrollHeight>r.clientHeight||r.scrollWidth>r.clientWidth,anime:r=>h.object(r)&&r.hasOwnProperty("animatables")&&!r.hasOwnProperty("add"),tl:r=>h.object(r)&&r.hasOwnProperty("add")&&h.function(r.add),animeInstance:r=>h.anime(r)||h.tl(r)},P=r=>r.split(/\s+/),y=(r,t)=>r&&r.getBoundingClientRect()[t],O=(r,t)=>t==="y"?r.scrollHeight:r.scrollWidth,f=(r,t)=>{h.string(r)&&(r=parseFloat(r));let i=Math.pow(10,t||0);return Math.round(r*i)/i};var d=(r,t)=>{let i=r,s=t;return Object.entries(i).forEach(([e,o])=>{h.object(o)?d(o,s[e]=s[e]||{}):e in s||(s[e]=o)}),s},_=r=>{throw new Error(r)},C=r=>{let t=r.getBoundingClientRect(),{top:i,bottom:s,right:e,left:o,height:a,width:n,x:l,y:c}=t;return{top:i,left:o,height:a,width:n,x:l,y:c,right:e-(e-o-r.clientWidth),bottom:s-(s-i-r.clientHeight)}};var L=class{constructor(t){return this._it=t,this.setUtils(),this}setUtils(){this.isVirtical=()=>this._it.axis==="y",this.isRootViewport=()=>!this._it._root,this.getRoot=()=>this._it._root??window,this.dirProps=()=>this.isVirtical()?{ref:"top",length:"height",refOpposite:"bottom",innerLength:innerHeight}:{ref:"left",length:"width",refOpposite:"right",innerLength:innerWidth},this.setRootMargin=()=>{let t=O(this.isRootViewport()?document.body:this._it._root,this.isVirtical()?"x":"y");return this.isVirtical()?`${this._it._positions.rootLeavePosition.strValue} ${t}px ${this._it._positions.rootEnterPosition.strValue} ${t}px`:`${t}px ${this._it._positions.rootEnterPosition.strValue} ${t}px ${this._it._positions.rootLeavePosition.strValue}`},this.setThreshold=()=>{let t=[0,this._it._triggerParams.enter,this._it._triggerParams.leave,f(1-this._it._triggerParams.leave,2),1];return this._it.triggers.forEach(i=>{let{enter:s,leave:e}=this.getTriggerData(i);t.push(s,e,f(1-e,2))}),[...new Set(t)]},this.parseQuery=(t,i)=>{switch(!0){case h.string(t):return[...document.querySelectorAll(t)];case h.array(t):return t;case h.element(t):return[t];default:_(`${i} parameter must be a valid selector, an element or array of elements`)}},this.customParseQuery=(t,i="trigger")=>{let s=i==="trigger",e=s?[]:{};return s?this.parseQuery(t,"trigger"):(e=h.string(t)?document.querySelector(t):h.element(t)?t:_("root parameter must be a valid selector or an element"),e)},this.validatePosition=(t,i)=>(h.function(i)&&(i=i(this)),h.string(i)||_(`${t} parameter must be a string.`),i),this.setPositionData=(t,i=!0,s=!0)=>{t=this.validatePosition(s?"enter":"leave",t);let e=t.trim(),o=h.percent(e),a=h.pixel(e),n={};if(e=o?e.replace("%",""):a?e.replace("px",""):e,e=f(e),n.type=o?"percent":"pixel",o&&i)return n.value=e/100,n.strValue=`${e}%`,n;let{length:l,innerLength:c}=this.dirProps(),u=this._it._root?y(this._it._root,l):c;switch(!0){case(o&&s):n.value=f(e/100-1,2),n.strValue=`${n.value*100}%`;break;case(o&&!s):n.value=-e/100,n.strValue=`${n.value*100}%`;break;case(a&&s):n.value=f(e-u,2),n.strValue=`${n.value}px`;break;case(a&&!s):n.value=-e,n.strValue=`${-e}px`;break}return n.guide=t,n},this.parsePositions=(t="",i="")=>{t=this.validatePosition("enter",t),i=this.validatePosition("leave",i);let s=t.trim().split(/\s+/g,2),e=i.trim().split(/\s+/g,2),o=[...s,...e];return{triggerEnterPosition:this.setPositionData(o[0]),rootEnterPosition:this.setPositionData(o[1],!1),triggerLeavePosition:this.setPositionData(o[2]),rootLeavePosition:this.setPositionData(o[3],!1,!1)}},this.deleteTriggerData=t=>{this._it._triggersData.delete(t)},this.hasTriggerData=(t,i=null)=>{let s=this._it._triggersData.has(t);return i?s&&i in this.getTriggerData(t):s},this.getTriggerData=(t,i=null)=>i?this.hasTriggerData(t,i)?this._it._triggersData.get(t)[i]:{}:this.hasTriggerData(t)&&this._it._triggersData.get(t)||{},this.setTriggerData=(t,i,s=null)=>{if(s){let e=this.getTriggerData(t);h.object(e)&&this._it._triggersData.set(t,{...e,...s});return}this._it._triggersData.set(t,i)},this.getTriggerStates=t=>{let i=this.getTriggerData(t,"states"),s=i.hasEntered||i.hasEnteredBack;return{...i,hasEnteredFromOneSide:s}},this.setTriggerStates=(t,i={})=>{let s=this.getTriggerData(t),e=s&&{...s.states,...i};this.setTriggerData(t,null,{states:e})},this.onTriggerEnter=(t,i="Enter")=>{let{hasEnteredOnce:s}=this.getTriggerStates(t),{onEnter:e,onEnterBack:o,toggleClass:a,animation:n}=this.getTriggerData(t),l=i==="Enter",c={callback:l?e:o,enterProp:l?"hasEntered":"hasEnteredBack",leaveProp:l?"hasLeftBack":"hasLeft",eventIndex:l?0:2};c.callback(t,this),a&&this.toggleClass(t,a,c.eventIndex),n&&this.animate(t,n,c.eventIndex);let u=s?{[c.enterProp]:!0,[c.leaveProp]:!1}:{[c.enterProp]:!0,hasLeft:!1,hasLeftBack:!1};this.setTriggerStates(t,u),s||this.setTriggerStates(t,{hasEnteredOnce:!0})},this.onTriggerLeave=(t,i="Leave")=>{let{once:s}=this.getTriggerData(t),{hasEnteredOnce:e}=this.getTriggerStates(t),{onLeave:o,onLeaveBack:a,toggleClass:n,animation:l}=this.getTriggerData(t),c=i==="Leave",u={callback:c?o:a,leaveProp:c?"hasLeft":"hasLeftBack",eventIndex:c?1:3};u.callback(t,this),n&&this.toggleClass(t,n,u.eventIndex),l&&this.animate(t,l,u.eventIndex),this.setTriggerStates(t,{[u.leaveProp]:!0,hasEntered:!1,hasEnteredBack:!1}),s&&e&&this._it.remove(t)},this.animate=(t,i,s)=>{let{instance:e,toggleActions:o,control:a}=i;if(!e)return;if(a){switch(s){case 0:break}return}let n=o[s];if(n!=="none")switch(n){case"play":e.reversed&&e.reverse(),1>e.progress&&e[n]();break;case"restart":case"reset":e.reversed&&e.reverse(),e[n]();break;case"pause":break;case"finish":e.pause(),e.seek(e.reversed?0:e.duration);break;case"reverse":if(e.reversed)break;e[n](),e.paused&&e.play();break;case"kill":h.inObject(e,"kill")&&e.kill(),this.setTriggerData(t,null,{animation:{...k}});break}},this.toggleClass=(t,i,s)=>{for(let{targets:e,toggleActions:o,classNames:a}of i)o[s]!=="none"&&a.forEach(n=>e.forEach(l=>l==="trigger"?t.classList[o[s]](n):l.classList[o[s]](n)))},this.parseToggleClass=t=>{let i=[];if(h.string(t)){let s=d(S,{targets:["trigger"],classNames:P(t)});return i.push([s]),i}return h.array(t)&&(i=t.map(s=>{let e=d(S,s),{targets:o,classNames:a,toggleActions:n}=e;return o&&(e.targets=this.parseQuery(o,"targets")),a&&(e.classNames=P(a)),h.string(n)&&(e.toggleActions=P(n)),e})),i},this.parseAnimation=t=>{let i={};switch(!0){case h.animeInstance(t):i=d(k,{instance:t});break;case h.object(t):{let s=d(k,t),{toggleActions:e}=s;h.string(e)&&(s.toggleActions=P(e)),i=s}break}return h.inObject(i,"instance")&&i.instance.reset(),i},this.toggleActions=t=>{let i=t.getBoundingClientRect();this._it.rootBounds=this.getRootRect(this._it.observer.rootMargin);let s=this._it.rootBounds,{enter:e,leave:o}=this.getTriggerData(t),{hasEnteredFromOneSide:a,hasLeft:n,hasLeftBack:l}=this.getTriggerStates(t),{ref:c,refOpposite:u,length:g}=this.dirProps(),m=!0;switch(!0){case(l&&i[c]+e*i[g]<=s[u]&&i[c]+e*i[g]>s[c]):this.onTriggerEnter(t);break;case(a&&i[c]+o*i[g]<=s[c]):this.onTriggerLeave(t);break;case(n&&i[c]+o*i[g]>=s[c]&&i[c]+o*i[g]<s[u]):this.onTriggerEnter(t,"EnterBack");break;case(a&&i[c]+e*i[g]>=s[u]):this.onTriggerLeave(t,"hasLeftBack");break;default:m=!1;break}return m},this.parseString=t=>t.split(/\s+/).map(s=>{let e=/^(-?\d*\.?\d+)(px|%)$/.exec(s);return{value:parseFloat(e[1]),unit:e[2]}}),this.parseRootMargin=t=>{var i=t||"0px",s=this.parseString(i);return s[1]=s[1]||s[0],s[2]=s[2]||s[0],s[3]=s[3]||s[1],s},this.expandRectByRootMargin=(t,i)=>{let s=this.parseRootMargin(i).map((o,a)=>o.unit=="px"?o.value:o.value*(a%2?t.width:t.height)/100),e={top:t.top-s[0],right:t.right+s[1],bottom:t.bottom+s[2],left:t.left-s[3]};return e.width=e.right-e.left,e.height=e.bottom-e.top,e},this.getRootRect=t=>{let i;if(this._it._root&&!h.doc(this._it._root))return i=C(this._it._root),this.expandRectByRootMargin(i,t);let s=h.doc(this._it._root)?this._it._root:document,e=s.documentElement,o=s.body;return i={top:0,left:0,right:e.clientWidth||o.clientWidth,width:e.clientWidth||o.clientWidth,bottom:e.clientHeight||o.clientHeight,height:e.clientHeight||o.clientHeight},this.expandRectByRootMargin(i,t)}}},A=L;var v=[],M=0,E=class{constructor(t={}){this._userOptions=t,this.triggers=[],this._triggersData=new WeakMap,this._guidesInstance=null,this._utils=new A(this),this.id=M,M++,v.push(this),this._setStates(),this._setInstance()}_setStates(){this._states={},this._states.oCbFirstInvoke=!0}_addScrollListener(){let t=this._utils.getRoot();!!this._onScrollHandler&&t.removeEventListener("scroll",this._onScrollHandler,!1);let i=s=>{this.triggers.forEach(e=>{let o=this._utils.getTriggerStates(e)?.onScroll;o&&o(e)}),this.onScroll(s,this)};this._onScrollHandler=s=>requestAnimationFrame(()=>i(s)),t.addEventListener("scroll",this._onScrollHandler,!1)}_createInstance(){this._threshold=this._utils.setThreshold(),this._observerOptions={root:this._root,rootMargin:this._rootMargin,threshold:this._threshold},this.observer=new IntersectionObserver(this._observerCallback,this._observerOptions),this._root=this.observer.root,this.rootBounds=this._utils.getRootRect(this.observer.rootMargin),this._isRootViewport=this._utils.isRootViewport(),this._addScrollListener()}_observerCallback=(t,i)=>{let{ref:s,refOpposite:e,length:o}=this._utils.dirProps();for(let a of t){let n=a.target,l=a.boundingClientRect,c=a.isIntersecting,u=a.intersectionRatio;this.rootBounds=a.rootBounds||this._utils.getRootRect(i.rootMargin);let g=this.rootBounds,m=g[o],I=m/l[o],{enter:T,leave:p}=this._utils.getTriggerData(n),{hasEnteredFromOneSide:D,onScroll:V}=this._utils.getTriggerStates(n),H=l[o]>=m,$=T>I,F=1-p>I,x=H&&($||F),R=!!V,j=l[s]+T*l[o]<g[e]&&l[s]+T*l[o]>g[s],W=l[s]+p*l[o]<g[e]&&l[s]+p*l[o]>g[s],Q=l[s]+T*l[o]<g[s],U=l[s]+p*l[o]>g[e],N=l[s]+p*l[o]<g[s]&&u<1-p,G=l[s]<g[s],z=l[e]<g[s];switch(!0){case this._states.oCbFirstInvoke:switch(!0){case(!c&&G&&z):this._utils.onTriggerEnter(n),this._utils.onTriggerLeave(n);break;case c:switch(!0){case(j||W||Q&&U):this._utils.onTriggerEnter(n);break;case N:this._utils.onTriggerEnter(n),this._utils.onTriggerLeave(n);break}x&&this._utils.setTriggerStates(n,{onScroll:this._utils.toggleActions});break}break;case!c:switch(R&&this._utils.setTriggerStates(n,{onScroll:null}),!0){case(D&&l[e]<g[s]):this._utils.onTriggerLeave(n);break;case(D&&l[s]>g[e]):this._utils.onTriggerLeave(n,"onLeaveBack");break}break;case(c&&!R):this._utils.toggleActions(n),x&&this._utils.setTriggerStates(n,{onScroll:this._utils.toggleActions});break}}this._states.oCbFirstInvoke=!1};_setInstance(){this._defaultOptions=w,this._options=d(this._defaultOptions,this._userOptions),this.axis=h.string(this._options.axis)?this._options.axis:_("axis parameter must be a string."),this.name=h.string(this._options.name)?this._options.name:_("name parameter must be a string."),this._root=!!this._options.root&&this._utils.customParseQuery(this._options.root,"root")||null,this._positions=this._utils.parsePositions(this._options.enter,this._options.leave),this.onScroll=this._options.onScroll;let{once:t,onEnter:i,onLeave:s,onEnterBack:e,onLeaveBack:o,toggleClass:a,animation:n}=this._options.defaults;return this._triggerParams={enter:this._positions.triggerEnterPosition.value,leave:this._positions.triggerLeavePosition.value,once:t,onEnter:i,onLeave:s,onEnterBack:e,onLeaveBack:o,toggleClass:a,animation:n},this._rootMargin=this._utils.setRootMargin(),this._createInstance(),this}add(t={},i={}){let s=this._utils.customParseQuery(t);"enter"in i&&(i.enter=this._utils.setPositionData(i.enter).value),"leave"in i&&(i.leave=this._utils.setPositionData(i.leave).value);let e={...d(this._triggerParams,i),states:{...B}};e.toggleClass&&(e.toggleClass=this._utils.parseToggleClass(e.toggleClass)),e.animation&&(e.animation=this._utils.parseAnimation(e.animation)),this.triggers=[...this.triggers,...s],this.triggers=[...new Set(this.triggers)];let o=!1;return[i.enter,i.leave].forEach(a=>!this._threshold.some(n=>a===n)&&(o=!0)),o?(this._disconnect(),s.forEach(a=>this._utils.setTriggerData(a,e)),this._createInstance(),this.triggers.forEach(a=>this.observer.observe(a))):s.forEach(a=>{this._utils.setTriggerData(a,e),this.observer.observe(a)}),this._guidesInstance&&this._guidesInstance.refresh(),this}remove(t={}){let i=this._utils.customParseQuery(t);i.forEach(e=>{this._utils.deleteTriggerData(e),this.observer.unobserve(e)});let s=this.triggers.filter(e=>!i.some(a=>e===a));return this.triggers=s,this._guidesInstance&&this._guidesInstance.refresh(),this}_disconnect(){this.observer&&this.observer.disconnect(),this.observer=null}kill(){this._disconnect(),removeEventListener("scroll",this._onScrollHandler,!1),this.triggers=[],this.removeGuides();let t=v.indexOf(this);~t&&v.splice(t,1)}addGuides(t){return h.inObject(t,"_registerIntersectionTrigger")||_("Invalid Guides Instance."),t._registerIntersectionTrigger(this),t.refresh(),this._guidesInstance=t,this}removeGuides(){return this._guidesInstance&&this._guidesInstance.kill(),this._guidesInstance=null,this}update(){this._guidesInstance&&this._guidesInstance.refresh()}};E.getInstances=()=>v;E.getInstanceById=r=>v.find(t=>t.id===r);E.update=()=>v.forEach(r=>r.update());export{E as default};
